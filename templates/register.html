<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Register — E2E Messaging Demo</title>
  <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
  <main class="page">
    <section class="card" style="max-width:720px;margin:auto;">
      <h1>Create account</h1>

      {% with messages = get_flashed_messages(category_filter=["error"]) %}
        {% if messages %}
          <div class="notice" role="alert" style="color:#f87171;">
            {% for msg in messages %}{{ msg }}<br>{% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      {% with messages = get_flashed_messages(category_filter=["success"]) %}
        {% if messages %}
          <div class="notice" role="status" style="color:#34d399;">
            {% for msg in messages %}{{ msg }}<br>{% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      <form id="register-form" method="post" action="{{ url_for('register') }}" class="form-grid" autocomplete="off" novalidate>
        {% if csrf_token is defined %}
          <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        {% elif form is defined %}
          {{ form.hidden_tag() }}
        {% endif %}

        <div>
          <label for="username">Username</label>
          <input id="username" name="username" type="text" required maxlength="150" pattern="[A-Za-z0-9_.-]{3,150}"
                 title="3–150 characters. Letters, numbers, underscore, hyphen or dot." autofocus>
          <p class="notice">3–150 characters, letters/numbers/_/./- only.</p>
        </div>

        <div>
          <label for="email">Email (optional)</label>
          <input id="email" name="email" type="email" placeholder="you@example.com" maxlength="254" autocapitalize="off">
          <p class="notice">Used only for optional recovery/notifications.</p>
        </div>

        <div>
          <label for="password">Password</label>
          <input id="password" name="password" type="password" required autocomplete="new-password">
        </div>

        <div>
          <label for="confirm_password">Confirm password</label>
          <input id="confirm_password" name="confirm_password" type="password" required autocomplete="new-password">
        </div>

        <div>
          <label>
            <input id="show_pw" type="checkbox" /> Show passwords
          </label>
        </div>

        <div>
          <button id="submit" type="submit">Create account</button>
          <p class="notice">By creating an account you agree to handle data responsibly. Demo use only.</p>
        </div>
      </form>
    </section>
  </main>

  <script>
    const password = document.getElementById('password');
    const confirm = document.getElementById('confirm_password');
    const showPw = document.getElementById('show_pw');

    showPw.addEventListener('change', (e) => {
      const t = e.target.checked ? 'text' : 'password';
      password.type = t;
      confirm.type = t;
    });
  </script>
</body>
</html>
